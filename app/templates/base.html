<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>{{ title if title else "Fundamental Ecom LLC" }}</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <script defer src="/static/js/app.js"></script>
    <script defer src="/static/js/rollcall.js"></script>
</head>
<body>
<header class="site-header">
    <div class="logo">Fundamental Ecom LLC</div>
    {% if user %}
    <nav>
        <a href="/dashboard">Dashboard</a>
        <a href="/dashboard/profile">Profile</a>
        <a href="/dashboard/history">History</a>
        <a href="/reports">Reports</a>
        {% if user.role in ["OWNER", "ADMIN"] %}
        <a href="/admin">Admin</a>
        {% endif %}
        <form action="/logout" method="post" style="display:inline">
            <button type="submit">Logout</button>
        </form>
    </nav>
    {% endif %}
</header>
<div class="app-shell {% if not user %}app-shell--solo{% endif %}">
    <main class="app-content">
        {% block content %}{% endblock %}
    </main>
    {% if user %}
    <aside class="chat-dock" id="chat-dock" data-user-role="{{ user.role }}">
        <div class="chat-dock-handle" data-chat-dock-resizer aria-hidden="true"></div>
        <div class="chat-shell" data-chat-shell>
            <section class="chat-sidebar" data-chat-sidebar>
                <div class="chat-sidebar__header">
                    <div>
                        <p class="muted">Messaging</p>
                        <strong>Rooms & Direct</strong>
                    </div>
                    {% if user.role in ["OWNER", "ADMIN"] %}
                    <button type="button" class="chat-manage-button" data-chat-manage-trigger>Manage</button>
                    {% endif %}
                </div>
                <ul class="chat-thread-list" data-chat-thread-list>
                    <li class="chat-panel-empty">Loading chatsâ€¦</li>
                </ul>
            </section>
            <section class="chat-conversation">
                <header class="chat-conversation__header">
                    <div>
                        <h3 data-chat-room-name>Fundamental Ecom LLC</h3>
                        <p data-chat-room-meta>Active now â€¢ Broadcast to members</p>
                    </div>
                    <div class="chat-conversation__actions">
                        <button type="button" aria-label="Start voice call">ðŸ”Š</button>
                        <button type="button" aria-label="Start video call">ðŸ“¹</button>
                        <button type="button" aria-label="More chat actions">â‹¯</button>
                    </div>
                </header>
                <div class="chat-thread-window">
                    <div class="rollcall-banner" id="rollcall-panel" hidden>
                        <div>
                            <p class="rollcall-label">Roll call in progress</p>
                            <p class="rollcall-target" data-rollcall-target>Waiting for the next call</p>
                            <p class="muted"><span data-rollcall-deadline>You're clear</span></p>
                        </div>
                        <div class="rollcall-actions">
                            <button id="rollcall-respond" type="button">I'm here</button>
                            <p class="muted" data-rollcall-note></p>
                        </div>
                    </div>
                    <div class="chat-messages" data-chat-messages="room"></div>
                </div>
                <form class="chat-composer" data-chat-form="room">
                    <label class="sr-only" for="dock-chat-input">Message</label>
                    <textarea id="dock-chat-input" name="content" rows="3" placeholder="Aa"></textarea>
                    <div class="chat-composer__actions">
                        <button type="button" aria-label="Add attachment">ðŸ“Ž</button>
                        <button type="button" aria-label="Add emoji">ðŸ˜Š</button>
                        <button type="submit">Send</button>
                    </div>
                </form>
            </section>
            <div class="chat-column-handle" data-chat-column-resizer aria-hidden="true"></div>
        </div>
        {% if user.role in ["OWNER", "ADMIN"] %}
        <section class="chat-manager" data-chat-manager hidden>
            <div class="chat-manager__panel">
                <div class="chat-manager__head">
                    <div>
                        <p class="muted">Control center</p>
                        <strong>Group chat administration</strong>
                    </div>
                    <button type="button" class="chat-manager__close" data-chat-manage-close>&times;</button>
                </div>
                <section class="chat-manager__section">
                    <h4>Create a new group</h4>
                    <form data-chat-create-form class="chat-manager__form">
                        <label>Group name
                            <input type="text" name="name" required minlength="3" maxlength="120">
                        </label>
                        <label>Add members
                            <select name="members" multiple data-chat-create-members></select>
                        </label>
                        <div class="chat-manager__settings">
                            <label><input type="checkbox" name="allow_media" checked> Allow media uploads</label>
                            <label><input type="checkbox" name="allow_mentions" checked> Allow @mentions</label>
                            <label><input type="checkbox" name="allow_replies" checked> Allow threaded replies</label>
                        </div>
                        <button type="submit">Create group chat</button>
                    </form>
                    <p class="chat-manager__feedback" data-chat-create-feedback></p>
                </section>
                <section class="chat-manager__section" data-chat-room-admin hidden>
                    <h4>Manage existing group</h4>
                    <label>Select room
                        <select data-chat-room-select></select>
                    </label>
                    <form data-chat-rename-form class="chat-manager__form" hidden>
                        <label>Group name
                            <input type="text" name="name" minlength="3" maxlength="120">
                        </label>
                        <div class="chat-manager__settings">
                            <label><input type="checkbox" name="allow_media"> Allow media uploads</label>
                            <label><input type="checkbox" name="allow_mentions"> Allow @mentions</label>
                            <label><input type="checkbox" name="allow_replies"> Allow threaded replies</label>
                        </div>
                        <button type="submit">Save changes</button>
                    </form>
                    <div class="chat-member-list" data-chat-member-list></div>
                    <form data-chat-add-member-form class="chat-manager__form" hidden>
                        <label>Add member
                            <select data-chat-add-member-options></select>
                        </label>
                        <button type="submit">Add to room</button>
                    </form>
                    <p class="chat-manager__feedback" data-chat-room-feedback></p>
                </section>
            </div>
        </section>
        {% endif %}
    </aside>
    {% endif %}
</div>
{% if user %}
<script defer src="/static/js/chat.js"></script>
{% endif %}
</body>
</html>
