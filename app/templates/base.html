<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>{{ title if title else "Fundamental Ecom LLC" }}</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <script defer src="/static/js/app.js"></script>
    <script defer src="/static/js/rollcall.js"></script>
</head>
<body>
<header class="site-header">
    <div class="logo">Fundamental Ecom LLC</div>
    {% if user %}
    <nav>
        <a href="/dashboard">Dashboard</a>
        <a href="/dashboard/profile">Profile</a>
        <a href="/dashboard/history">History</a>
        <a href="/reports">Reports</a>
        {% if user.role in ["OWNER", "ADMIN"] %}
        <a href="/admin">Admin</a>
        {% endif %}
        <form action="/logout" method="post" style="display:inline">
            <button type="submit">Logout</button>
        </form>
    </nav>
    {% endif %}
</header>
<div class="app-shell {% if not user %}app-shell--solo{% endif %}">
    <main class="app-content">
        {% block content %}{% endblock %}
    </main>
    {% if user %}
    <aside class="chat-dock" id="chat-dock" data-user-role="{{ user.role }}" data-user-id="{{ user.id }}">
        <div class="chat-dock-handle" data-chat-dock-resizer aria-hidden="true"></div>
        <div class="chat-shell" data-chat-shell>
            <section class="chat-sidebar" data-chat-sidebar>
                {% if user.role in ["OWNER", "ADMIN"] %}
                <div class="chat-sidebar__header">
                    <button type="button" class="chat-pill-button" data-chat-manage-trigger>
                        <span>New group</span>
                    </button>
                </div>
                {% endif %}
                <label class="chat-search">
                    <span class="chat-search__icon">üîç</span>
                    <input type="search" placeholder="Search chats" data-chat-thread-search autocomplete="off">
                </label>
                <div class="chat-thread-filters" data-chat-thread-filters>
                    <button type="button" class="chat-filter-button is-active" data-chat-thread-filter="all">All</button>
                    <button type="button" class="chat-filter-button" data-chat-thread-filter="unread">Unread</button>
                    <button type="button" class="chat-filter-button" data-chat-thread-filter="groups">Groups</button>
                    <button type="button" class="chat-filter-button" data-chat-thread-filter="direct">Direct</button>
                </div>
                <div class="chat-thread-scroll" data-chat-thread-scroll>
                    <ul class="chat-thread-list" data-chat-thread-list>
                        <li class="chat-panel-empty">Loading chats‚Ä¶</li>
                    </ul>
                </div>
            </section>
            <section class="chat-conversation" data-chat-conversation>
                <div class="chat-conversation__alerts">
                    <div class="rollcall-banner" id="rollcall-panel" hidden>
                        <div>
                            <p class="rollcall-label">Roll call in progress</p>
                            <p class="rollcall-target" data-rollcall-target>Waiting for the next call</p>
                            <p class="muted"><span data-rollcall-deadline>You're clear</span></p>
                        </div>
                        <div class="rollcall-actions">
                            <button id="rollcall-respond" type="button">I'm here</button>
                            <p class="muted" data-rollcall-note></p>
                        </div>
                    </div>
                </div>
                <header class="chat-conversation__header">
                    <div class="chat-room-presence" data-chat-room-presence></div>
                    <div class="chat-conversation__actions">
                        <button type="button" class="chat-icon-button" data-chat-room-action="delete" title="Delete group">üóë</button>
                        <button type="button" class="chat-icon-button" data-chat-room-action="more" title="More actions">‚ãØ</button>
                    </div>
                </header>
                <div class="chat-thread-window" data-chat-thread-window>
                    <div class="chat-messages" data-chat-messages="room"></div>
                    <button type="button" class="chat-scroll-latest" data-chat-scroll-latest hidden>
                        Jump to latest
                    </button>
                </div>
                <form class="chat-composer" data-chat-form="room" autocomplete="off">
                    <div class="chat-composer__toolbar">
                        <div class="chat-composer__tools">
                            <label class="chat-icon-button" title="Attach files">
                                üìé
                                <input type="file" data-chat-file-input multiple hidden>
                            </label>
                            <button type="button" class="chat-icon-button" data-chat-emoji title="Emoji">üòä</button>
                            <button type="button" class="chat-icon-button" data-chat-mention-trigger title="Mention">@</button>
                        </div>
                        <span class="chat-composer__hint" data-chat-composer-hint>Mentions, attachments, and roll-call alerts are supported.</span>
                    </div>
                    <label class="sr-only" for="dock-chat-input">Message</label>
                    <textarea id="dock-chat-input" name="content" rows="3" placeholder="Message..." data-chat-input></textarea>
                    <div class="chat-composer__bottom">
                        <div class="chat-composer__status" data-chat-composer-status></div>
                        <button type="submit">Send</button>
                    </div>
                </form>
                <div class="mention-popover" data-mention-popover hidden>
                    <ul class="mention-options" data-mention-options></ul>
                </div>
            </section>
            <div class="chat-column-handle" data-chat-column-resizer aria-hidden="true"></div>
        </div>
        {% if user.role in ["OWNER", "ADMIN"] %}
        <section class="chat-manager" data-chat-manager hidden>
            <div class="chat-manager__panel">
                <div class="chat-manager__head">
                    <div>
                        <p class="muted">Control center</p>
                        <strong>Group chat administration</strong>
                    </div>
                    <button type="button" class="chat-manager__close" data-chat-manage-close>&times;</button>
                </div>
                <section class="chat-manager__section">
                    <h4>Create a new group</h4>
                    <form data-chat-create-form class="chat-manager__form">
                        <label>Group name
                            <input type="text" name="name" required minlength="3" maxlength="120">
                        </label>
                        <label>Add members
                            <select name="members" multiple data-chat-create-members></select>
                        </label>
                        <div class="chat-manager__settings">
                            <label><input type="checkbox" name="allow_media" checked> Allow media uploads</label>
                            <label><input type="checkbox" name="allow_mentions" checked> Allow @mentions</label>
                            <label><input type="checkbox" name="allow_replies" checked> Allow threaded replies</label>
                        </div>
                        <button type="submit">Create group chat</button>
                    </form>
                    <p class="chat-manager__feedback" data-chat-create-feedback></p>
                </section>
                <section class="chat-manager__section" data-chat-room-admin hidden>
                    <h4>Manage existing group</h4>
                    <label>Select room
                        <select data-chat-room-select></select>
                    </label>
                    <form data-chat-rename-form class="chat-manager__form" hidden>
                        <label>Group name
                            <input type="text" name="name" minlength="3" maxlength="120">
                        </label>
                        <div class="chat-manager__settings">
                            <label><input type="checkbox" name="allow_media"> Allow media uploads</label>
                            <label><input type="checkbox" name="allow_mentions"> Allow @mentions</label>
                            <label><input type="checkbox" name="allow_replies"> Allow threaded replies</label>
                        </div>
                        <button type="submit">Save changes</button>
                    </form>
                    <div class="chat-member-list" data-chat-member-list></div>
                    <form data-chat-add-member-form class="chat-manager__form" hidden>
                        <label>Add member
                            <select data-chat-add-member-options></select>
                        </label>
                        <button type="submit">Add to room</button>
                    </form>
                    <p class="chat-manager__feedback" data-chat-room-feedback></p>
                </section>
            </div>
        </section>
        {% endif %}
    </aside>
    {% endif %}
</div>
{% if user %}
<script defer src="/static/js/chat.js"></script>
{% endif %}
</body>
</html>
