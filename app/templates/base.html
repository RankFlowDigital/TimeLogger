<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>{{ title if title else "Team Monitor" }}</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <script defer src="/static/js/app.js"></script>
    <script defer src="/static/js/rollcall.js"></script>
</head>
<body>
<header class="site-header">
    <div class="logo">Team Monitor</div>
    {% if user %}
    <nav>
        <a href="/dashboard">Dashboard</a>
        <a href="/dashboard/profile">Profile</a>
        <a href="/dashboard/history">History</a>
        <a href="/chat">Chat</a>
        {% if user.role in ["OWNER", "ADMIN"] %}
        <a href="/admin">Admin</a>
        <a href="/admin/reports">Reports</a>
        {% endif %}
        <form action="/logout" method="post" style="display:inline">
            <button type="submit">Logout</button>
        </form>
    </nav>
    {% endif %}
</header>
<div class="app-shell {% if not user %}app-shell--solo{% endif %}">
    <main class="app-content">
        {% block content %}{% endblock %}
    </main>
    {% if user %}
    <aside class="chat-dock" id="chat-dock">
        <div class="chat-shell" data-chat-shell>
            <section class="chat-sidebar">
                <header class="chat-sidebar__header">
                    <div>
                        <p class="muted">Chats</p>
                        <h2>Messenger</h2>
                    </div>
                    <div class="chat-sidebar__actions">
                        <button type="button" aria-label="New chat">+</button>
                        <button type="button" aria-label="Chat options">‚ãØ</button>
                    </div>
                </header>
                <label class="chat-sidebar__search">
                    <span class="sr-only">Search chats</span>
                    <input type="search" placeholder="Search messenger" />
                </label>
                <div class="chat-tabs" role="tablist">
                    <button class="chat-tab active" data-chat-tab="groups" type="button">Group chats</button>
                    <button class="chat-tab" data-chat-tab="direct" type="button">Direct</button>
                </div>
                <div class="chat-panels chat-panels--lists">
                    <section class="chat-panel active" data-chat-panel="groups" role="tabpanel">
                        <ul class="chat-thread-list">
                            <li class="chat-thread active">
                                <button type="button" data-thread="team">
                                    <div class="thread-avatar">TM</div>
                                    <div class="thread-body">
                                        <strong>Team Monitor</strong>
                                        <span>All hands ‚Ä¢ active</span>
                                    </div>
                                    <div class="thread-meta">
                                        <time data-thread-updated>now</time>
                                    </div>
                                </button>
                            </li>
                            <li class="chat-thread muted">
                                <button type="button">
                                    <div class="thread-avatar">RC</div>
                                    <div class="thread-body">
                                        <strong>Roll-call updates</strong>
                                        <span>Automated reminders</span>
                                    </div>
                                    <div class="thread-meta">
                                        <span class="badge">2</span>
                                    </div>
                                </button>
                            </li>
                        </ul>
                    </section>
                    <section class="chat-panel" data-chat-panel="direct" role="tabpanel" aria-hidden="true">
                        <ul class="chat-thread-list">
                            <li class="chat-thread">
                                <button type="button">
                                    <div class="thread-avatar">JD</div>
                                    <div class="thread-body">
                                        <strong>Juan Dela Cruz</strong>
                                        <span>‚ÄúOn lunch, back 1pm.‚Äù</span>
                                    </div>
                                    <div class="thread-meta">
                                        <time>11:45 AM</time>
                                    </div>
                                </button>
                            </li>
                            <li class="chat-thread">
                                <button type="button">
                                    <div class="thread-avatar">MS</div>
                                    <div class="thread-body">
                                        <strong>Mara Santos</strong>
                                        <span>‚ÄúReport submitted ‚úÖ‚Äù</span>
                                    </div>
                                    <div class="thread-meta">
                                        <time>10:10 AM</time>
                                    </div>
                                </button>
                            </li>
                            <li class="chat-thread">
                                <button type="button">
                                    <div class="thread-avatar">AT</div>
                                    <div class="thread-body">
                                        <strong>Andre Torres</strong>
                                        <span>‚ÄúNeed help on QC?‚Äù</span>
                                    </div>
                                    <div class="thread-meta">
                                        <time>09:05 AM</time>
                                    </div>
                                </button>
                            </li>
                        </ul>
                    </section>
                </div>
            </section>
            <section class="chat-conversation">
                <header class="chat-conversation__header">
                    <div>
                        <h3>Team Monitor</h3>
                        <p>Active now ‚Ä¢ Broadcast to members</p>
                    </div>
                    <div class="chat-conversation__actions">
                        <button type="button" aria-label="Start voice call">üîä</button>
                        <button type="button" aria-label="Start video call">üìπ</button>
                        <button type="button" aria-label="More chat actions">‚ãØ</button>
                    </div>
                </header>
                <div class="chat-thread-window">
                    <div class="rollcall-banner" id="rollcall-panel" hidden>
                        <div>
                            <p>Roll call in progress</p>
                            <p class="muted"><span data-rollcall-deadline>Respond promptly</span></p>
                        </div>
                        <button id="rollcall-respond" type="button">I'm here</button>
                    </div>
                    <div class="chat-messages" data-chat-messages="team"></div>
                </div>
                <form class="chat-composer" data-chat-form="team">
                    <label class="sr-only" for="dock-chat-input">Message</label>
                    <textarea id="dock-chat-input" name="content" rows="3" placeholder="Aa"></textarea>
                    <div class="chat-composer__actions">
                        <button type="button" aria-label="Add attachment">üìé</button>
                        <button type="button" aria-label="Add emoji">üòä</button>
                        <button type="submit">Send</button>
                    </div>
                </form>
                <section class="chat-utilities">
                    <div>
                        <h3>Team presence</h3>
                        <ul class="team-roster" data-team-roster></ul>
                    </div>
                    <div>
                        <h3>Invite teammate</h3>
                        <form class="invite-form" data-invite-form>
                            <input type="text" name="full_name" placeholder="Full name" required>
                            <input type="email" name="email" placeholder="Email" required>
                            <select name="role">
                                <option value="MEMBER">Member</option>
                                <option value="ADMIN">Admin</option>
                            </select>
                            <select name="timezone" data-invite-timezone>
                                <option value="">No timezone preference</option>
                            </select>
                            <button type="submit">Send invite</button>
                            <p class="form-feedback" data-invite-feedback></p>
                        </form>
                    </div>
                    <div>
                        <h3>Roll-call log</h3>
                        <ul class="rollcall-log" data-rollcall-log></ul>
                    </div>
                </section>
            </section>
            <div class="chat-column-handle" data-chat-column-resizer aria-hidden="true"></div>
        </div>
        <div class="chat-dock-handle" data-chat-dock-resizer aria-hidden="true"></div>
    </aside>
    {% endif %}
</div>
{% if user %}
<script defer src="/static/js/chat.js"></script>
{% endif %}
</body>
</html>
