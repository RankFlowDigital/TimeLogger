{% extends "base.html" %}
{% block content %}
{% if settings_updated %}
<div class="alert success">Roll call frequency updated.</div>
{% endif %}
<section class="panel">
    <h2>Roll Call Frequency</h2>
    <p>Currently set to <strong>{{ rollcall_target }}</strong> roll calls per hour.</p>
    {% if can_edit_rollcalls %}
    <form method="post" action="/admin/settings/rollcalls" class="form-inline">
        <label for="rollcalls_per_hour">Roll calls per hour (1-12)</label>
        <input type="number" id="rollcalls_per_hour" name="rollcalls_per_hour" min="1" max="12" value="{{ rollcall_target }}" required>
        <button type="submit">Save</button>
    </form>
    <p class="help-text">Spacing remains random between 5 and 16 minutes even after you change this number.</p>
    {% else %}
    <p class="muted">Only the organization owner can change this value.</p>
    {% endif %}
</section>
<section class="panel">
    <h2>Invite teammate</h2>
    <p class="muted">Send credentials to a new teammate and optionally select their default timezone.</p>
    <form class="invite-form" data-invite-form>
        <input type="text" name="full_name" placeholder="Full name" required>
        <input type="email" name="email" placeholder="Email" required>
        <select name="role">
            <option value="MEMBER">Member</option>
            <option value="ADMIN">Admin</option>
        </select>
        <select name="timezone" data-invite-timezone>
            <option value="">No timezone preference</option>
        </select>
        <button type="submit">Send invite</button>
        <p class="form-feedback" data-invite-feedback></p>
    </form>
</section>
<section class="panel">
    <div class="panel-heading">
        <h2>Scheduling &amp; shifts</h2>
        <a class="button-link" href="/admin/shifts">Open shift planner</a>
    </div>
    <p class="muted">Need to create shift templates or give someone temporary permission to start without a shift? Jump into the shift planner to manage assignments and manual overrides.</p>
</section>
<section class="panel" data-admin-users-page>
    <div class="panel-heading">
        <h2>Team Status</h2>
        <div class="panel-actions">
            <button type="button" class="danger" data-admin-delete-selected disabled>Remove selected</button>
        </div>
    </div>
    <p class="muted">Select teammates to remove them individually or in bulk. Owners and your own account cannot be removed.</p>
    <p class="form-feedback" data-admin-users-feedback></p>
    <table data-admin-users-table>
        <thead>
            <tr>
                <th>
                    <label class="sr-only" for="admin-user-select-all">Select all users</label>
                    <input type="checkbox" id="admin-user-select-all" data-admin-user-select-all>
                </th>
                <th>Name</th>
                <th>Status</th>
                <th>Since</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in statuses %}
            {% set is_self = item.user.id == user.id %}
            {% set is_owner = item.user.role == "OWNER" %}
            {% set removable = (not is_self and not is_owner) %}
            <tr data-admin-user-row data-user-id="{{ item.user.id }}" data-user-removable="{{ 'true' if removable else 'false' }}">
                <td>
                    <label class="sr-only" for="admin-user-select-{{ item.user.id }}">Select {{ item.user.full_name }}</label>
                    <input type="checkbox" id="admin-user-select-{{ item.user.id }}" data-admin-user-checkbox value="{{ item.user.id }}" {% if not removable %}disabled{% endif %}>
                </td>
                <td>
                    <strong>{{ item.user.full_name }}</strong>
                    <div class="muted small-text">{{ item.user.email }} Â· {{ item.user.role.title() }}</div>
                </td>
                <td>{{ item.status }}</td>
                <td>{{ item.since or '-' }}</td>
                <td>
                    <button type="button" class="danger" data-admin-user-delete data-user-id="{{ item.user.id }}" data-user-name="{{ item.user.full_name }}" {% if not removable %}disabled{% endif %}>Remove</button>
                    {% if is_self %}
                    <span class="tag">You</span>
                    {% elif is_owner %}
                    <span class="tag">Owner</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>
{% endblock %}
